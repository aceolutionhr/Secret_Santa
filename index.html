<script>
  let employees = [];

  // Fun Santa messages for multiple clicks
  const santaMessages = [
    "ğŸ… Ho Ho Ho! Same person again ğŸ˜„",
    "ğŸ„ Santa says: Stop checking, start shopping ğŸ",
    "ğŸ˜ˆ Naughty list alert! No reshuffle",
    "ğŸ… Destiny is locked!",
    "ğŸ Surprise! Still the same lucky person",
    "ğŸ„ Santa is watching you ğŸ‘€"
  ];

  // Load employee data
  fetch("data.json")
    .then(res => res.json())
    .then(data => employees = data)
    .catch(() => alert("âŒ Unable to load employee list"));

  function reveal() {
    const empId = document.getElementById("user").value.trim().toUpperCase();
    if (!empId) {
      alert("ğŸ… Please enter your Employee ID");
      return;
    }

    const result = document.getElementById("result");
    result.style.display = "block";

    const assignKey = "secret_santa_" + empId;
    const clickKey = "click_count_" + empId;

    // Increase click count
    let clicks = Number(localStorage.getItem(clickKey) || 0);
    clicks++;
    localStorage.setItem(clickKey, clicks);

    // If already assigned
    if (localStorage.getItem(assignKey)) {
      const saved = JSON.parse(localStorage.getItem(assignKey));

      // Show fun message after first click
      if (clicks > 1) {
        const msg =
          santaMessages[Math.floor(Math.random() * santaMessages.length)];

        result.innerHTML =
          msg + "<br><br>" +
          "ğŸ You are the Secret Santa for<br><br>" +
          "<span style='color:#b11226'>" + saved.name + "</span><br>" +
          "<small>(Emp ID: " + saved.empId + ")</small><br><br>" +
          "<em>Keep it secret ğŸ„</em>";
      } else {
        showResult(saved);
      }
      return;
    }

    // First-time assignment
    const random =
      employees[Math.floor(Math.random() * employees.length)];

    localStorage.setItem(assignKey, JSON.stringify(random));
    showResult(random);
  }

  function showResult(data) {
    document.getElementById("result").innerHTML =
      "ğŸ You are the Secret Santa for<br><br>" +
      "<span style='color:#b11226'>" + data.name + "</span><br>" +
      "<small>(Emp ID: " + data.empId + ")</small><br><br>" +
      "<em>Stick to it and spread joy ğŸ„</em>";
  }
</script>
